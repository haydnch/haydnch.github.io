<!DOCTYPE html>
<html lang="zh-CN">

  <head>
  
<script src="/js/clicklove.js"></script>

  <meta charset="utf-8">
  <meta name="haydn" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  
  <title>CentOS7安装mysql | Haydn&#39;s Blog</title>
  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
  

  
    <link rel="apple-touch-icon" href="/images/favicon.jpg">
    <link rel="icon" href="/images/favicon.jpg">
  
  
  
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">
  
  <!-- 引入font-awesome字体 -->
  <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">


  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


  
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-xxxxxxx-x"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-xxxxxxx-x');
    </script>
  

<meta name="generator" content="Hexo 5.0.2"></head>


  <body>
    <div id="app">
      <div class="header">

  <div class = "music" >
  <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=350 height=86 
	src="//music.163.com/outchain/player?type=2&id=316938&auto=0&height=66">
  </iframe>
  </div>
  <div class="avatar">
    <a href="/"><img src="/images/bear.jpg" alt=""></a>
    <div class="nickname"><a href="/">Haydn CH</a></div>
	
  </div>
  <div class="poem">
   <span id="jinrishici-sentence">正在加载今日诗词...</span> 
    <!--
	<div id="poem_sentence"></div>
	<div id="poem_info"></div>
	-->
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">主页</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">归档</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">分类</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">标签</a>
        </li>
      
        <li class="nav-item" data-path="/friends/">
          <a href="/friends/">友链</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">关于</a>
        </li>
      
    </ul>
	
  </div>
 


</div>


<script src="/js/activeNav.js"></script>


	
      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->



  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">CentOS7安装mysql</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="更新时间 | updatetime"></i>
          2020-08-22
        </span>
		
        
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="类别 | categories"></i>
                
                <span class="span--category">
                  <a href="/categories/Tutorial/" title="查看 Tutorial 分类">
                    <b>#</b> Tutorial
                  </a>
                </span>
                
              </span>
          
              <span class="post-tags">
                <i class="iconfont icon-tags" title="标签 | tags"></i>
                
                <span class="span--tag">
                  <a href="/tags/mysql/" title="查看 mysql 标签">
                    <b>#</b> mysql
                  </a>
                </span>
                
                <span class="span--tag">
                  <a href="/tags/ECS/" title="查看 ECS 标签">
                    <b>#</b> ECS
                  </a>
                </span>
                
              </span>
          
		
        <!-- 不蒜子统计 -->
        <span id="busuanzi_container_page_pv"  class="post-readNum">
              <i class="iconfont icon-eye"></i> 阅读量：<span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
        </span>

      </div>
      <div class="markdown-body">
        <p><strong><u>记录在阿里云ECS实例CentOS7.6 中安装Mysql数据库的步骤。</u></strong></p>
<h1 id="1-删除MariaDB"><a href="#1-删除MariaDB" class="headerlink" title="1 删除MariaDB"></a>1 删除MariaDB</h1><p>Cent OS 7 的 yum 源中已经不再包含在 MySQL，而改用了 MariaDB。</p>
<h2 id="1-1-查询Maria-DB是否已经安装"><a href="#1-1-查询Maria-DB是否已经安装" class="headerlink" title="1 .1 查询Maria DB是否已经安装"></a>1 .1 查询Maria DB是否已经安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep maria*</span><br></pre></td></tr></table></figure>

<h2 id="1-2-删除MariaDB"><a href="#1-2-删除MariaDB" class="headerlink" title="1.2 删除MariaDB"></a>1.2 删除MariaDB</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y remove maria*</span><br></pre></td></tr></table></figure>

<h1 id="2-下载mysql-yum包"><a href="#2-下载mysql-yum包" class="headerlink" title="2 下载mysql yum包"></a>2 下载mysql yum包</h1><p>进入 mysql 官方提供的 yum 包下载页面，地址为：**<a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/repo/yum/"></a>** ，页面如下，选择适合自己系统的 yum 包。</p>
<p><img src="https://gitee.com/haydnch/myImage/raw/master/imgs/yum.PNG" alt="yum"></p>
<p>这里下载的是==mysql80-community-release-el7-3.noarch.rpm==</p>
<h1 id="3-安装mysql-yum包"><a href="#3-安装mysql-yum包" class="headerlink" title="3 安装mysql yum包"></a>3 安装mysql yum包</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh mysql80-community-release-el7-3.noarch.rpm</span><br></pre></td></tr></table></figure>

<h1 id="4-安装mysql"><a href="#4-安装mysql" class="headerlink" title="4 安装mysql"></a>4 安装mysql</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y mysql-community-server</span><br></pre></td></tr></table></figure>

<h1 id="5-启动mysql"><a href="#5-启动mysql" class="headerlink" title="5 启动mysql"></a>5 启动mysql</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动mysql </span></span><br><span class="line">systemctl start mysqld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询mysql状态</span></span><br><span class="line">systemctl status mysqld.service</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看mysql安装路径</span></span><br><span class="line">whereis mysql</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/haydnch/myImage/raw/master/imgs/image-20200801183444424.png" alt="image-20200801183444424"></p>
<h1 id="6-更改默认密码"><a href="#6-更改默认密码" class="headerlink" title="6 更改默认密码"></a>6 更改默认密码</h1><p>安装后默认会生成一个复杂临时密码，保存在<code>/var/log/mysqld.log </code>这个文件中，可以输入以下命令通过查找文件得到密码。</p>
<ul>
<li><strong>查找默认密码</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep <span class="string">&#x27;temporary password&#x27;</span> /var/<span class="built_in">log</span>/mysqld.log</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/haydnch/myImage/raw/master/imgs/image-20200801184705295.png" alt="image-20200801184705295"></p>
<p>然后我们根据这个密码进入数据库。</p>
<p>如果不更改密码的话，无法进行数据库操作。</p>
<p><img src="https://gitee.com/haydnch/myImage/raw/master/imgs/image-20200801185011118.png" alt="image-20200801185011118"></p>
<ul>
<li><strong>通过以下命令更改密码</strong></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> identified by <span class="string">&#x27;your_password&#x27;</span>;</span><br><span class="line">或者</span><br><span class="line">mysqladmin -u root -p password</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/haydnch/myImage/raw/master/imgs/image-20200806141901184.png" alt="image-20200806141901184"></p>
<p>在这里我们不能设置像1234、root这种简单密码，因为数据库设置了密码强度规则。因此先设置一个包含大小写字母、数字等的复杂密码，能通过强度验证。</p>
<p><img src="https://gitee.com/haydnch/myImage/raw/master/imgs/image-20200801185740361.png" alt="image-20200801185740361"></p>
<ul>
<li><strong>查看密码相关安全设置</strong></li>
</ul>
<p><img src="https://gitee.com/haydnch/myImage/raw/master/imgs/image-20200801185933120.png" alt="image-20200801185933120"></p>
<ul>
<li><p><strong>修改密码强度设置</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password.length = 1;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">set</span> global validate_password.policy = 0;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>设置以后就可以将数据库密码修改成简单密码了。</p>
<p>当然，这个修改只建议在开发测试环境下使用，如果在生产环境使用简单密码，会导致数据库密码极易被破解，使得数据库中的数据有泄露的风险。</p>
</li>
</ul>
<h1 id="7-设置允许远程连接"><a href="#7-设置允许远程连接" class="headerlink" title="7 设置允许远程连接"></a>7 设置允许远程连接</h1><p>  由于是在阿里云ECS中安装的数据库，为了便于操作，我们通常在本地的数据库管理软件进行远程连接。</p>
<p>  首先在阿里云控制台安全组中添加配置规则，放行端口号3306。</p>
<p>  <img src="https://gitee.com/haydnch/myImage/raw/master/imgs/group.png" alt="group"></p>
<p>  此时连接服务器上的数据库，会报错拒绝访问。</p>
<p>  <img src="https://gitee.com/haydnch/myImage/raw/master/imgs/deny.png" alt="deny"></p>
<p>  回到服务器，查看用户表：</p>
<p>  <img src="https://gitee.com/haydnch/myImage/raw/master/imgs/image-20200801191820053.png" alt="image-20200801191820053"></p>
<p>  用户root对应的host为localhost，只允许本地访问。因此执行以下命令：</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update user <span class="built_in">set</span> host=<span class="string">&#x27;%&#x27;</span> <span class="built_in">where</span> user=<span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">alter user <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified with mysql_native_password by <span class="string">&#x27;your_password&#x27;</span>;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

<p>  此时再在本地连接数据库，就可以连接成功。</p>
<p>  <img src="https://gitee.com/haydnch/myImage/raw/master/imgs/image-20200801192323522.png" alt="image-20200801192323522"></p>
<h1 id="8-部署web项目到阿里云ECS"><a href="#8-部署web项目到阿里云ECS" class="headerlink" title="8 部署web项目到阿里云ECS"></a>8 部署web项目到阿里云ECS</h1><p>  服务器数据库安装好后，将本地数据库导出为sql文件再导入服务器数据库中。</p>
<p>由于之后会把本地IDEA项目打包成war包然后上传到服务器tomcat的webapp进行运行，所以要在项目的数据库配置文件中修改。在这里有一个需要注意的地方：</p>
<p>注意本地mysql和服务器mysql版本的不同。由于本机是较老的5.5版本，阿里云ECS中安装的是8.0.21版本，项目中的数据库连接驱动也要换成高版本的。</p>
<p><img src="https://gitee.com/haydnch/myImage/raw/master/imgs/image-20200802095405773.png" alt="image-20200802095405773"></p>
<p>mysql8.0以上连接驱动的配置要如下设置：</p>
<p><code>driver = com.mysql.cj.jdbc.Driver</code><br><code>url = jdbc:mysql://localhost:3306/yourdb?useSSL=false&amp;serverTimezone=UTC</code></p>
<p>新版本的driverClass必须要加上 <strong>cj</strong>，url中<strong>useSSL</strong>和<strong>serverTimezone</strong>也必须有，否则会报错。</p>

      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-prev">
            
              <a href="/2020/08/22/docker/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>PREV: docker</span>
              </a>
            
          </div>
		  <!--
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="更新时间 | updatetime"></i>
              2020-08-22
            </span>
            
                  <span class="post-categories">
                    <i class="iconfont icon-bookmark" title="类别 | categories"></i>
                    
                    <span class="span--category">
                      <a href="/categories/Tutorial/" title="查看 Tutorial 分类">
                        <b>#</b> Tutorial
                      </a>
                    </span>
                    
                  </span>
              
                  <span class="post-tags">
                    <i class="iconfont icon-tags" title="标签 | tags"></i>
                    
                    <span class="span--tag">
                      <a href="/tags/mysql/" title="查看 mysql 标签">
                        <b>#</b> mysql
                      </a>
                    </span>
                    
                    <span class="span--tag">
                      <a href="/tags/ECS/" title="查看 ECS 标签">
                        <b>#</b> ECS
                      </a>
                    </span>
                    
                  </span>
              
          </div>
		  -->
          <div class="post-foot-prev">
            
              <a href="/2020/08/21/hello-world/" target="_self">
                <span>NEXT: Hello World</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    
  <div class="post-catalog" id="catalog">
    <div class="title">目录</div>
    <div class="catalog-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%88%A0%E9%99%A4MariaDB"><span class="toc-text">1 删除MariaDB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E6%9F%A5%E8%AF%A2Maria-DB%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%AE%89%E8%A3%85"><span class="toc-text">1 .1 查询Maria DB是否已经安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%88%A0%E9%99%A4MariaDB"><span class="toc-text">1.2 删除MariaDB</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E4%B8%8B%E8%BD%BDmysql-yum%E5%8C%85"><span class="toc-text">2 下载mysql yum包</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85mysql-yum%E5%8C%85"><span class="toc-text">3 安装mysql yum包</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%AE%89%E8%A3%85mysql"><span class="toc-text">4 安装mysql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E5%90%AF%E5%8A%A8mysql"><span class="toc-text">5 启动mysql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E6%9B%B4%E6%94%B9%E9%BB%98%E8%AE%A4%E5%AF%86%E7%A0%81"><span class="toc-text">6 更改默认密码</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E8%AE%BE%E7%BD%AE%E5%85%81%E8%AE%B8%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5"><span class="toc-text">7 设置允许远程连接</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E9%83%A8%E7%BD%B2web%E9%A1%B9%E7%9B%AE%E5%88%B0%E9%98%BF%E9%87%8C%E4%BA%91ECS"><span class="toc-text">8 部署web项目到阿里云ECS</span></a></li></ol>
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        




  
  
   
  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
  
<link rel="stylesheet" href="/css/gitalk.css">

  
<script src="/js/md5.js"></script>

  <div id="gitalk-container"></div>

  <script>
    const gitalk = new Gitalk({
      clientID: '3dc2460c4142aef1640d',
      clientSecret: 'cc570c6f9e10c1d086a8b1ba81332843825d00f4',
      repo: 'haydnch.github.io',
      owner: 'haydnch',
      admin: ['haydnch'],
      id: md5(location.pathname),
      distractionFreeMode: false
    })

    gitalk.render('gitalk-container')
  </script>


      </div>
    
  </div>


        <div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/haydnch/haydnch.github.io">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="twitter" href="">
            <i class="iconfont icon-twitter"></i>
          </a>
        </li>
      
        <li>
          <a title="微信" href="/about/">
            <i class="iconfont icon-wechat"></i>
          </a>
        </li>
      
        <li>
          <a title="微博" target="_blank" rel="noopener" href="https://weibo.com/574422066/">
            <i class="iconfont icon-weibo"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
  
    <div class="footer-more">
      <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Copyright © Oranges 2020 | Powered by Hexo</a>
    </div>
  
 
 
	 <div class="visit">
        <!-- 不蒜子统计 -->
        <span id="busuanzi_container_site_pv">
                本站总访问量<span id="busuanzi_value_site_pv"></span>次
        </span>
        <span class="post-meta-divider">|</span>
        <span id="busuanzi_container_site_uv">
                本站访客数<span id="busuanzi_value_site_uv"></span>人
        </span>
	</div>
     
	 
  
</div>

      </div>

      <div class="back-to-top hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



      
  <div class="search-icon" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        <input type="text" class="search-input" id="search-input" placeholder="搜索你想查找的文章...">
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
	var searchOverlayArea = document.querySelector(".search-overlay")
	
    inputArea.onclick = function(){ 
	  getSearchFile(); 
	  this.onclick = null 
	}		    

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }
  
    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }
  
    function blurSearchContent(e) {
	  if (e.target === searchOverlayArea) {
    	      
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)
  </script>
  
  
<script src="/js/search.js"></script>




    </div>
	
  <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":200,"height":350,"hOffset":10,"vOffset":-50},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"dialog":{"enable":true,"hitokoto":true,"scale":0.7},"log":false});</script></body>
</html>
